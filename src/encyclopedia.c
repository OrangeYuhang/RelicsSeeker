#include "../include/encyclopedia.h"
#include <windows.h>

// æ¸…å±å‡½æ•°
static void clearScreen(void) {
    system("cls");
}

// è®¾ç½®é¢œè‰²
static void setColor(int color) {
#ifdef _WIN32
    HANDLE hConsole = GetStdHandle(STD_OUTPUT_HANDLE);
    SetConsoleTextAttribute(hConsole, color);
#endif
}

// æ˜¾ç¤ºå›¾é‰´èœå•
void displayEncyclopediaMenu(int selected) {
    clearScreen();
    
    setColor(11);
    printf("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n");
    printf("             å›¾é‰´ç³»ç»Ÿ\n");
    printf("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n");
    setColor(7);
    
    const char* options[] = {"ç‰©å“å›¾é‰´", "æ€ªç‰©å›¾é‰´", "é—ç‰©å›¾é‰´", "æˆå°±å›¾é‰´", "è¿”å›"};
    
    for (int i = 0; i < 5; i++) {
        if (i == selected) {
            setColor(14);
            printf("  > %s\n", options[i]);
            setColor(7);
        } else {
            printf("    %s\n", options[i]);
        }
    }
    
    setColor(11);
    printf("\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n");
    setColor(14);
    printf("æ“ä½œ: W/Sé”®é€‰æ‹© â†‘/â†“ | å›è½¦é”®ç¡®è®¤ | Qé”®è¿”å›\n");
    setColor(7);
}

// æ˜¾ç¤ºç‰©å“å›¾é‰´
void displayItemsEncyclopedia(int page) {
    clearScreen();
    
    setColor(11);
    printf("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n");
    printf("           ç‰©å“å›¾é‰´ (ç¬¬%dé¡µ/å…±2é¡µ)\n", page + 1);
    printf("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n");
    setColor(7);
    
    if (page == 0) {
        printf(" æ²»ç–—ç±»ç‰©å“ï¼š\n");
        printf("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n");
        printf("â€¢ åˆçº§æ²»ç–—è¯æ°´\n");
        printf("  æ•ˆæœï¼šæ¢å¤50ç‚¹ç”Ÿå‘½å€¼\n");
        printf("  ä»·æ ¼ï¼š50é‡‘å¸\n");
        printf("  ç”¨é€”ï¼šæˆ˜æ–—åæ¢å¤ç”Ÿå‘½\n");
        printf("\nâ€¢ ä¸­çº§æ²»ç–—è¯æ°´\n");
        printf("  æ•ˆæœï¼šæ¢å¤100ç‚¹ç”Ÿå‘½å€¼\n");
        printf("  ä»·æ ¼ï¼š80é‡‘å¸\n");
        printf("  ç”¨é€”ï¼šç´§æ€¥æ²»ç–—\n");
        printf("\nâ€¢ é«˜çº§æ²»ç–—è¯æ°´\n");
        printf("  æ•ˆæœï¼šæ¢å¤200ç‚¹ç”Ÿå‘½å€¼\n");
        printf("  ä»·æ ¼ï¼š150é‡‘å¸\n");
        printf("  ç”¨é€”ï¼šå¤§é‡æ¢å¤ç”Ÿå‘½\n");
    } else {
        printf(" å·¥å…·ç±»ç‰©å“ï¼š\n");
        printf("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n");
        printf("â€¢ ä½çº§ç»´ä¿®å¥—ä»¶\n");
        printf("  æ•ˆæœï¼šä¿®å¤é—ç‰©20%%æŸå\n");
        printf("  æˆåŠŸç‡ï¼š40%%\n");
        printf("  ä»·æ ¼ï¼š100é‡‘å¸\n");
        printf("\nâ€¢ ä¸­çº§ç»´ä¿®å¥—ä»¶\n");
        printf("  æ•ˆæœï¼šä¿®å¤é—ç‰©35%%æŸå\n");
        printf("  æˆåŠŸç‡ï¼š70%%\n");
        printf("  ä»·æ ¼ï¼š200é‡‘å¸\n");
        printf("\nâ€¢ é«˜çº§ç»´ä¿®å¥—ä»¶\n");
        printf("  æ•ˆæœï¼šä¿®å¤é—ç‰©50%%æŸå\n");
        printf("  æˆåŠŸç‡ï¼š90%%\n");
        printf("  ä»·æ ¼ï¼š400é‡‘å¸\n");
        printf("\nâ€¢ èƒŒåŒ…æ‰©å±•åˆ¸\n");
        printf("  æ•ˆæœï¼šå¢åŠ èƒŒåŒ…å®¹é‡10æ ¼\n");
        printf("  ä»·æ ¼ï¼š300é‡‘å¸\n");
        printf("  ç”¨é€”ï¼šæ‰©å±•èƒŒåŒ…ç©ºé—´\n");
    }
    
    setColor(11);
    printf("\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n");
    setColor(14);
    printf("æ“ä½œ: A/Dé”®ç¿»é¡µ â†/â†’ | Qé”®è¿”å›å›¾é‰´èœå•\n");
    setColor(7);
}

// æ˜¾ç¤ºæ€ªç‰©å›¾é‰´
void displayMonstersEncyclopedia(int page) {
    clearScreen();
    
    setColor(11);
    printf("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n");
    printf("           æ€ªç‰©å›¾é‰´ (ç¬¬%dé¡µ/å…±2é¡µ)\n", page + 1);
    printf("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n");
    setColor(7);
    
    if (page == 0) {
        printf("æ™®é€šæ€ªç‰©ï¼š\n");
        printf("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n");
        printf("â€¢ æ£®æ—ç‹¼\n");
        printf("  å‡ºç°åœ°ç‚¹ï¼šé­”æ³•æ£®æ—\n");
        printf("  éš¾åº¦ï¼šâ˜…â˜†â˜†â˜†â˜†\n");
        printf("  æ‰è½ï¼šé‡‘å¸20-50ï¼Œç»éªŒ30\n");
        printf("  ç‰¹ç‚¹ï¼šç§»åŠ¨é€Ÿåº¦å¿«\n");
        printf("\nâ€¢ æ´ç©´è™è \n");
        printf("  å‡ºç°åœ°ç‚¹ï¼šåœ°ä¸‹æ´ç©´\n");
        printf("  éš¾åº¦ï¼šâ˜…â˜†â˜†â˜†â˜†\n");
        printf("  æ‰è½ï¼šé‡‘å¸15-40ï¼Œç»éªŒ25\n");
        printf("  ç‰¹ç‚¹ï¼šä¼šé£è¡Œ\n");
        printf("\nâ€¢ çŸ³å¤´å‚€å„¡\n");
        printf("  å‡ºç°åœ°ç‚¹ï¼šå¤ä»£é—è¿¹\n");
        printf("  éš¾åº¦ï¼šâ˜…â˜…â˜†â˜†â˜†\n");
        printf("  æ‰è½ï¼šé‡‘å¸30-70ï¼Œç»éªŒ40\n");
        printf("  ç‰¹ç‚¹ï¼šé˜²å¾¡åŠ›é«˜\n");
    } else {
        printf("ç²¾è‹±æ€ªç‰©ï¼š\n");
        printf("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n");
        printf("â€¢ ç«ç„°èœ¥èœ´\n");
        printf("  å‡ºç°åœ°ç‚¹ï¼šç«å±±æ´ç©´\n");
        printf("  éš¾åº¦ï¼šâ˜…â˜…â˜…â˜†â˜†\n");
        printf("  æ‰è½ï¼šé‡‘å¸80-150ï¼Œç»éªŒ80\n");
        printf("  ç‰¹ç‚¹ï¼šç«å±æ€§æ”»å‡»\n");
        printf("\nâ€¢ å†°éœœå·¨é­”\n");
        printf("  å‡ºç°åœ°ç‚¹ï¼šå†°å°é—è¿¹\n");
        printf("  éš¾åº¦ï¼šâ˜…â˜…â˜…â˜…â˜†\n");
        printf("  æ‰è½ï¼šé‡‘å¸120-200ï¼Œç»éªŒ120\n");
        printf("  ç‰¹ç‚¹ï¼šå†°å±æ€§æ”»å‡»ï¼Œç§»åŠ¨ç¼“æ…¢\n");
        printf("\nğŸ‘‘ BOSSæ€ªç‰©ï¼š\n");
        printf("â€¢ é—è¿¹å®ˆæŠ¤è€…\n");
        printf("  å‡ºç°åœ°ç‚¹ï¼šå¤ä»£é—è¿¹æ·±å¤„\n");
        printf("  éš¾åº¦ï¼šâ˜…â˜…â˜…â˜…â˜…\n");
        printf("  æ‰è½ï¼šé‡‘å¸500-800ï¼Œç»éªŒ300\n");
        printf("  ç‰¹ç‚¹ï¼šå…¨å±æ€§æ”»å‡»ï¼Œé˜²å¾¡æé«˜\n");
        printf("  ç‰¹æ®Šå¥–åŠ±ï¼šå¤ä»£ç¥å™¨\n");
    }
    
    setColor(11);
    printf("\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n");
    setColor(14);
    printf("æ“ä½œ: A/Dé”®ç¿»é¡µ â†/â†’ | Qé”®è¿”å›å›¾é‰´èœå•\n");
    setColor(7);
}

// æ˜¾ç¤ºé—ç‰©å›¾é‰´
void displayRelicsEncyclopedia(int page) {
    clearScreen();
    
    setColor(11);
    printf("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n");
    printf("           é—ç‰©å›¾é‰´ (ç¬¬%dé¡µ/å…±2é¡µ)\n", page + 1);
    printf("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n");
    setColor(7);
    
    if (page == 0) {
        printf("é—ç‰©å“è´¨è¯´æ˜ï¼š\n");
        printf("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n");
        printf("â€¢ Cçº§é—ç‰©\n");
        printf("  åŸºç¡€ä»·å€¼ï¼š100-300é‡‘å¸\n");
        printf("  ä¿®å¤éš¾åº¦ï¼š30%%-50%%\n");
        printf("  å‡ºç°æ¦‚ç‡ï¼šå¸¸è§\n");
        printf("\nâ€¢ Bçº§é—ç‰©\n");
        printf("  åŸºç¡€ä»·å€¼ï¼š300-600é‡‘å¸\n");
        printf("  ä¿®å¤éš¾åº¦ï¼š40%%-60%%\n");
        printf("  å‡ºç°æ¦‚ç‡ï¼šä¸€èˆ¬\n");
        printf("\nâ€¢ Açº§é—ç‰©\n");
        printf("  åŸºç¡€ä»·å€¼ï¼š600-1000é‡‘å¸\n");
        printf("  ä¿®å¤éš¾åº¦ï¼š50%%-70%%\n");
        printf("  å‡ºç°æ¦‚ç‡ï¼šç¨€æœ‰\n");
        printf("\nâ€¢ Sçº§é—ç‰©\n");
        printf("  åŸºç¡€ä»·å€¼ï¼š1000-2000é‡‘å¸\n");
        printf("  ä¿®å¤éš¾åº¦ï¼š60%%-80%%\n");
        printf("  å‡ºç°æ¦‚ç‡ï¼šéå¸¸ç¨€æœ‰\n");
    } else {
        printf("è‘—åé—ç‰©ä»‹ç»ï¼š\n");
        printf("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n");
        printf("â€¢ é¾™ä¹‹æˆ’æŒ‡ (Açº§)\n");
        printf("  æè¿°ï¼šä¼ è¯´ä¸­é¾™æ—å®ˆæŠ¤çš„æˆ’æŒ‡\n");
        printf("  æ•ˆæœï¼šå¢åŠ ç«å±æ€§æŠ—æ€§\n");
        printf("  ä»·å€¼ï¼š500é‡‘å¸\n");
        printf("  è·å–æ–¹å¼ï¼šæ£®æ—å®è—\n");
        printf("\nâ€¢ å¤ä»£æŠ¤èº«ç¬¦ (Bçº§)\n");
        printf("  æè¿°ï¼šå¸¦æœ‰ç¥ç§˜ç¬¦æ–‡çš„æŠ¤èº«ç¬¦\n");
        printf("  æ•ˆæœï¼šæå‡é­”æ³•æ¢å¤é€Ÿåº¦\n");
        printf("  ä»·å€¼ï¼š300é‡‘å¸\n");
        printf("  è·å–æ–¹å¼ï¼šæ´ç©´å®è—\n");
        printf("\nâ€¢ ç²¾çµä¹‹æ³ª (Sçº§)\n");
        printf("  æè¿°ï¼šç²¾çµçš„çœ¼æ³ªç»“æ™¶\n");
        printf("  æ•ˆæœï¼šè•´å«å¼ºå¤§çš„è‡ªç„¶èƒ½é‡\n");
        printf("  ä»·å€¼ï¼š1500é‡‘å¸\n");
        printf("  è·å–æ–¹å¼ï¼šé—è¿¹æ·±å±‚å®è—\n");
        printf("\nâ€¢ å¤ä»£ç¥å™¨ (SSSçº§)\n");
        printf("  æè¿°ï¼šä¼ è¯´ä¸­çš„ç¥å™¨\n");
        printf("  æ•ˆæœï¼šå…·æœ‰ä¸å¯æ€è®®çš„åŠ›é‡\n");
        printf("  ä»·å€¼ï¼š5000é‡‘å¸\n");
        printf("  è·å–æ–¹å¼ï¼šå‡»è´¥é—è¿¹å®ˆæŠ¤è€…\n");
    }
    
    setColor(11);
    printf("\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n");
    setColor(14);
    printf("æ“ä½œ: A/Dé”®ç¿»é¡µ â†/â†’ | Qé”®è¿”å›å›¾é‰´èœå•\n");
    setColor(7);
}

// æ˜¾ç¤ºæˆå°±å›¾é‰´
void displayAchievementsEncyclopedia(int page) {
    clearScreen();
    
    setColor(11);
    printf("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n");
    printf("           æˆå°±å›¾é‰´ (ç¬¬%dé¡µ/å…±2é¡µ)\n", page + 1);
    printf("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n");
    setColor(7);
    
    if (page == 0) {
        printf("æ¢ç´¢æˆå°±ï¼š\n");
        printf("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n");
        printf("â€¢ åˆå‡ºèŒ…åº\n");
        printf("  æ¡ä»¶ï¼šå®Œæˆç¬¬ä¸€ä¸ªåœ°å›¾æ¢ç´¢\n");
        printf("  å¥–åŠ±ï¼šç»éªŒ100ï¼Œé‡‘å¸50\n");
        printf("\nâ€¢ å†’é™©å®¶\n");
        printf("  æ¡ä»¶ï¼šæ¢ç´¢æ‰€æœ‰åœ°å›¾ç±»å‹\n");
        printf("  å¥–åŠ±ï¼šç»éªŒ300ï¼Œé‡‘å¸200\n");
        printf("\nâ€¢ åœ°å›¾å¤§å¸ˆ\n");
        printf("  æ¡ä»¶ï¼šå®Œå…¨æ¢ç´¢3ä¸ªä¸åŒåœ°å›¾\n");
        printf("  å¥–åŠ±ï¼šç»éªŒ500ï¼Œé‡‘å¸500\n");
        printf("\nâ€¢ å®è—çŒäºº\n");
        printf("  æ¡ä»¶ï¼šæ‰¾åˆ°10ä¸ªå®è—\n");
        printf("  å¥–åŠ±ï¼šç»éªŒ200ï¼Œé‡‘å¸300\n");
        printf("\nâ€¢ äº‹ä»¶ä¸“å®¶\n");
        printf("  æ¡ä»¶ï¼šè§¦å‘20ä¸ªä¸åŒäº‹ä»¶\n");
        printf("  å¥–åŠ±ï¼šç»éªŒ300ï¼Œé‡‘å¸400\n");
    } else {
        printf("æˆ˜æ–—æˆå°±ï¼š\n");
        printf("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n");
        printf("â€¢ æ€ªç‰©æ€æ‰‹\n");
        printf("  æ¡ä»¶ï¼šå‡»è´¥50åªæ€ªç‰©\n");
        printf("  å¥–åŠ±ï¼šç»éªŒ400ï¼Œé‡‘å¸300\n");
        printf("\nâ€¢ ç²¾è‹±çŒäºº\n");
        printf("  æ¡ä»¶ï¼šå‡»è´¥10åªç²¾è‹±æ€ªç‰©\n");
        printf("  å¥–åŠ±ï¼šç»éªŒ600ï¼Œé‡‘å¸500\n");
        printf("\nâ€¢ BOSSå¾æœè€…\n");
        printf("  æ¡ä»¶ï¼šå‡»è´¥é—è¿¹å®ˆæŠ¤è€…\n");
        printf("  å¥–åŠ±ï¼šç»éªŒ1000ï¼Œé‡‘å¸1000\n");
        printf("\nâ€¢ æ— ä¼¤å¤§å¸ˆ\n");
        printf("  æ¡ä»¶ï¼šæ— ä¼¤å®Œæˆä¸€ä¸ªåœ°å›¾\n");
        printf("  å¥–åŠ±ï¼šç»éªŒ800ï¼Œé‡‘å¸700\n");
        printf("\nâ€¢ è¿æˆ˜è¿èƒœ\n");
        printf("  æ¡ä»¶ï¼šè¿ç»­å‡»è´¥20åªæ€ªç‰©\n");
        printf("  å¥–åŠ±ï¼šç»éªŒ500ï¼Œé‡‘å¸400\n");
        printf("\n æ”¶é›†æˆå°±ï¼š\n");
        printf("â€¢ æ”¶è—å®¶\n");
        printf("  æ¡ä»¶ï¼šæ”¶é›†æ‰€æœ‰ç±»å‹é—ç‰©\n");
        printf("  å¥–åŠ±ï¼šç»éªŒ700ï¼Œé‡‘å¸600\n");
        printf("\nâ€¢ ä¿®å¤å¤§å¸ˆ\n");
        printf("  æ¡ä»¶ï¼šæˆåŠŸä¿®å¤10æ¬¡é—ç‰©\n");
        printf("  å¥–åŠ±ï¼šç»éªŒ400ï¼Œé‡‘å¸350\n");
    }
    
    setColor(11);
    printf("\nâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n");
    setColor(14);
    printf("æ“ä½œ: A/Dé”®ç¿»é¡µ â†/â†’ | Qé”®è¿”å›å›¾é‰´èœå•\n");
    setColor(7);
}

// å¤„ç†å›¾é‰´è¾“å…¥
int handleEncyclopediaInput(int* selected, int* page, EncyclopediaType* type) {
    int ch = getch();
    
    switch (ch) {
        case 'w':
        case 'W':
            *selected = (*selected - 1 + 5) % 5;
            return 1; // ç»§ç»­æ˜¾ç¤ºèœå•
        case 's':
        case 'S':
            *selected = (*selected + 1) % 5;
            return 1; // ç»§ç»­æ˜¾ç¤ºèœå•
        case '\r': // å›è½¦é”®
        case '\n':
            if (*selected == 4) {
                return 0; // è¿”å›ä¸»èœå•
            } else {
                *type = (EncyclopediaType)*selected;
                *page = 0;
                return 2; // è¿›å…¥å…·ä½“å›¾é‰´
            }
        case 'q':
        case 'Q':
            return 0; // è¿”å›ä¸»èœå•
        default:
            return 1; // ç»§ç»­æ˜¾ç¤º
    }
}

// å¤„ç†å…·ä½“å›¾é‰´è¾“å…¥
int handleSpecificEncyclopediaInput(int* page, EncyclopediaType type) {
    int ch = getch();
    
    switch (ch) {
        case 'a':
        case 'A':
            *page = (*page - 1 + 2) % 2;
            return 1; // ç»§ç»­æ˜¾ç¤º
        case 'd':
        case 'D':
            *page = (*page + 1) % 2;
            return 1; // ç»§ç»­æ˜¾ç¤º
        case 'q':
        case 'Q':
            return 0; // è¿”å›å›¾é‰´èœå•
        default:
            return 1; // ç»§ç»­æ˜¾ç¤º
    }
}

// æ˜¾ç¤ºå›¾é‰´ç³»ç»Ÿ
void showEncyclopedia(void) {
    int selected = 0;
    int page = 0;
    EncyclopediaType currentType = ENCY_ITEMS;
    int state = 1; // 1:èœå•, 2:å…·ä½“å›¾é‰´, 0:è¿”å›
    
    while (state > 0) {
        if (state == 1) {
            // æ˜¾ç¤ºèœå•
            displayEncyclopediaMenu(selected);
            state = handleEncyclopediaInput(&selected, &page, &currentType);
        } else if (state == 2) {
            // æ˜¾ç¤ºå…·ä½“å›¾é‰´
            switch (currentType) {
                case ENCY_ITEMS:
                    displayItemsEncyclopedia(page);
                    break;
                case ENCY_MONSTERS:
                    displayMonstersEncyclopedia(page);
                    break;
                case ENCY_RELICS:
                    displayRelicsEncyclopedia(page);
                    break;
                case ENCY_ACHIEVEMENTS:
                    displayAchievementsEncyclopedia(page);
                    break;
            }
            state = handleSpecificEncyclopediaInput(&page, currentType);
            if (state == 0) {
                state = 1; // è¿”å›èœå•
                page = 0;
            }
        }
    }
}